steps:
  # Run helm install and helm registry login
  - name: gcr.io/cloud-builders/gcloud
    id: helm-registry-login
    entrypoint: /bin/bash
    args:
    - -c
    - |
      curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
      chmod 700 get_helm.sh
      ./get_helm.sh
      gcloud auth application-default print-access-token | helm registry login -u oauth2accesstoken \
        --password-stdin https://${LOCATION}-docker.pkg.dev
    waitFor: ['-']

  # Generate helm package for Little Quest
  - name: gcr.io/cloud-builders/gcloud
    id: helm-package
    entrypoint: /bin/bash
    args:
    - -c
    - |
      helm package ./

options:
  volumes:
  - name: apt-lists
    path: /var/lib/apt/lists
  - name: apt-archives
    path: /var/cache/apt/archives
